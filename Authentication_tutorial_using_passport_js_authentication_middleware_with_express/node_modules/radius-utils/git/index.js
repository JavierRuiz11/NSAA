const { spawn } = require("child_process");

const git = {};
const shell = { shell: true };

git.stage = async () =>
  new Promise((resolve, reject) => {
    const proc = spawn(`git add -A`, shell);

    proc.on("exit", (code) => {
      if (code !== 0) reject(code);
      else resolve();
    });
  });

git.commit = async (message = "Auto distribution", path = "./") =>
  new Promise((resolve, reject) => {
    const proc = spawn(`git -C ${path} commit -am '${message}'`, shell);

    proc.on("exit", (code) => {
      if (code !== 0) reject(code);
      else resolve();
    });
  });

git.push = async (params = "") =>
  new Promise((resolve, reject) => {
    const proc = spawn(`git push ${params}`, shell);

    proc.on("exit", (code) => {
      if (code !== 0) reject(code);
      else resolve();
    });
  });

git.checkout = async (branch) =>
  new Promise((resolve, reject) => {
    const proc = spawn(`git checkout ${branch}`, shell);

    proc.on("exit", (code) => {
      if (code !== 0) reject(code);
      else resolve();
    });
  });

git.merge = async (branch) =>
  new Promise((resolve, reject) => {
    const proc = spawn(`git merge ${branch}`, shell);

    proc.on("exit", (code) => {
      if (code !== 0) reject(code);
      else resolve();
    });
  });

git.isUncommittted = async (branch) =>
  new Promise((resolve, reject) => {
    const proc = spawn(`git diff --exit-code`, shell);

    proc.on("exit", (code) => {
      resolve(code > 0);
    });
  });

module.exports = git;
